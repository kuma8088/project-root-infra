# ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ˆç”»æ›¸

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: Unified Portal - Mailserverçµ±åˆ + DNSç®¡ç†å¼·åŒ–

**ç›®çš„**: å•é¡Œç™ºç”Ÿæ™‚ã«å®‰å…¨ã‹ã¤è¿…é€Ÿã«æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ï¼ˆFlask usermgmtï¼‰ã«åˆ‡ã‚Šæˆ»ã™

**ä½œæˆæ—¥**: 2025-11-14

---

## ğŸ“‹ æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Unified Portalå°å…¥å¾Œã«å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã®åˆ‡ã‚Šæˆ»ã—æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚

**è¨­è¨ˆæ–¹é‡**: ä¸¦è¡Œç¨¼åƒæœŸé–“ã‚’è¨­ã‘ã‚‹ã“ã¨ã§ã€ã„ã¤ã§ã‚‚ Flask usermgmt ã«æˆ»ã›ã‚‹å®‰å…¨ãªæ§‹æˆ

---

## ğŸš¨ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯åˆ¤æ–­åŸºæº–

ä»¥ä¸‹ã®ã„ãšã‚Œã‹ãŒç™ºç”Ÿã—ãŸå ´åˆã€å³åº§ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚

### ç·Šæ€¥åº¦: é«˜ï¼ˆå³åº§ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãŒå®Œå…¨ã«å¤±ã‚ã‚Œã‚‹
- [ ] ãƒ¡ãƒ¼ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆãŒå…¨ãæ©Ÿèƒ½ã—ãªã„
- [ ] ãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆãŒç™ºç”Ÿï¼ˆFlask usermgmtã¨ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºï¼‰
- [ ] èªè¨¼ãŒæ©Ÿèƒ½ã›ãšãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–ãŒè‘—ã—ã„ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ > 5ç§’ï¼‰
- [ ] ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ï¼ˆPostfix/Dovecotï¼‰ã«å½±éŸ¿ãŒå‡ºã‚‹

### ç·Šæ€¥åº¦: ä¸­ï¼ˆ1æ™‚é–“ä»¥å†…ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¤œè¨ï¼‰
- [ ] ä¸€éƒ¨æ©Ÿèƒ½ãŒå‹•ä½œã—ãªã„ï¼ˆä¾‹: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã®ã¿å¤±æ•—ï¼‰
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ãŒç›®æ¨™å€¤ã‚’è¶…ãˆã‚‹ï¼ˆ500ms < ãƒ¬ã‚¹ãƒãƒ³ã‚¹ < 3ç§’ï¼‰
- [ ] ç›£æŸ»ãƒ­ã‚°ãŒè¨˜éŒ²ã•ã‚Œãªã„
- [ ] UIã«è‡´å‘½çš„ãªãƒã‚°ãŒã‚ã‚‹

### ç·Šæ€¥åº¦: ä½ï¼ˆä¿®æ­£å¯èƒ½ã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ä¸è¦ï¼‰
- [ ] è»½å¾®ãªUIãƒã‚°
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ < 1ç§’ï¼‰
- [ ] ãƒ­ã‚°å‡ºåŠ›ã®å•é¡Œ

---

## ğŸ”„ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¬ãƒ™ãƒ«

### Level 1: Unified Portalåœæ­¢ã®ã¿ï¼ˆæœ€ã‚‚å®‰å…¨ãƒ»æ¨å¥¨ï¼‰
- **æ‰€è¦æ™‚é–“**: 5åˆ†
- **å½±éŸ¿**: Unified Portal ãŒä½¿ç”¨ä¸å¯ã«ãªã‚‹ãŒã€Flask usermgmt ã¯æ­£å¸¸ç¨¼åƒ
- **ãƒ‡ãƒ¼ã‚¿æå¤±**: ãªã—
- **æ¨å¥¨çŠ¶æ³**: è»½å¾®ãªå•é¡Œã€ãƒ†ã‚¹ãƒˆä¸­ã®å•é¡Œ

### Level 2: Unified Portalå®Œå…¨å‰Šé™¤
- **æ‰€è¦æ™‚é–“**: 15åˆ†
- **å½±éŸ¿**: Unified Portal é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ã‚³ãƒ³ãƒ†ãƒŠã‚’å…¨å‰Šé™¤
- **ãƒ‡ãƒ¼ã‚¿æå¤±**: ãªã—ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯å…±æœ‰ã®ãŸã‚å½±éŸ¿ãªã—ï¼‰
- **æ¨å¥¨çŠ¶æ³**: æ·±åˆ»ãªå•é¡Œã€å†æ§‹ç¯‰ãŒå¿…è¦

### Level 3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚¹ãƒˆã‚¢ï¼ˆæœ€çµ‚æ‰‹æ®µï¼‰
- **æ‰€è¦æ™‚é–“**: 30åˆ†
- **å½±éŸ¿**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’äº‹å‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ™‚ç‚¹ã«æˆ»ã™
- **ãƒ‡ãƒ¼ã‚¿æå¤±**: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å–å¾—å¾Œã®å…¨å¤‰æ›´ãŒå¤±ã‚ã‚Œã‚‹
- **æ¨å¥¨çŠ¶æ³**: ãƒ‡ãƒ¼ã‚¿ç ´æã€ä¸æ•´åˆãŒè§£æ±ºä¸å¯èƒ½

---

## ğŸ“ Level 1: Unified Portalåœæ­¢ã®ã¿

### å‰ææ¡ä»¶
- Flask usermgmt ãŒç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç•°å¸¸ãŒãªã„ã“ã¨

### æ‰‹é †

#### Step 1: Unified Portalåœæ­¢ï¼ˆ2åˆ†ï¼‰
```bash
cd /opt/onprem-infra-system/project-root-infra/services/unified-portal

# ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢
docker compose down

# åœæ­¢ç¢ºèª
docker ps | grep unified-portal
# ï¼ˆä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ã“ã¨ã‚’ç¢ºèªï¼‰
```

#### Step 2: Flask usermgmtç¨¼åƒç¢ºèªï¼ˆ2åˆ†ï¼‰
```bash
# Flask usermgmtã‚³ãƒ³ãƒ†ãƒŠç¢ºèª
docker ps | grep usermgmt

# Web UIç¢ºèª
xdg-open http://172.20.0.80:5000

# ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤ºã‚’ç¢ºèª
```

#### Step 3: é–¢ä¿‚è€…ã¸ã®é€šçŸ¥ï¼ˆ1åˆ†ï¼‰
```bash
# ãƒ­ã‚°ã«è¨˜éŒ²
echo "[$(date)] Unified Portal rolled back to Flask usermgmt" >> \
  /var/log/unified-portal-rollback.log

# ï¼ˆå¿…è¦ã«å¿œã˜ã¦ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ç­‰ï¼‰
```

### æ¤œè¨¼é …ç›®
- [ ] Flask usermgmt ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ãŒæ­£å¸¸è¡¨ç¤º
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼CRUDæ“ä½œãŒæ­£å¸¸å‹•ä½œ
- [ ] ç›£æŸ»ãƒ­ã‚°ãŒè¨˜éŒ²ã•ã‚Œã‚‹

---

## ğŸ“ Level 2: Unified Portalå®Œå…¨å‰Šé™¤

### å‰ææ¡ä»¶
- Level 1 ã§å•é¡ŒãŒè§£æ±ºã—ãªã„
- Unified Portal ã‚’å®Œå…¨ã«å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

### æ‰‹é †

#### Step 1: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆï¼ˆ5åˆ†ï¼‰
```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
tar -czf /mnt/backup-hdd/unified-portal-before-delete_$(date +%Y%m%d_%H%M%S).tar.gz \
  /opt/onprem-infra-system/project-root-infra/services/unified-portal

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆå¿µã®ãŸã‚ï¼‰
docker exec mailserver-mariadb-1 mysqldump \
  -u usermgmt -p<password> mailserver_usermgmt > \
  /mnt/backup-hdd/mailserver_usermgmt_before-delete_$(date +%Y%m%d_%H%M%S).sql
```

#### Step 2: Unified Portalå‰Šé™¤ï¼ˆ5åˆ†ï¼‰
```bash
cd /opt/onprem-infra-system/project-root-infra/services/unified-portal

# ã‚³ãƒ³ãƒ†ãƒŠãƒ»ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å…¨å‰Šé™¤
docker compose down -v

# ã‚¤ãƒ¡ãƒ¼ã‚¸å‰Šé™¤
docker rmi unified-portal-backend unified-portal-frontend unified-portal-nginx

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¸ˆã¿ãªã®ã§æ®‹ã™ï¼ˆå‰Šé™¤ã—ãŸã„å ´åˆã¯ä»¥ä¸‹ï¼‰
# rm -rf /opt/onprem-infra-system/project-root-infra/services/unified-portal
```

#### Step 3: Flask usermgmtç¨¼åƒç¢ºèªï¼ˆ2åˆ†ï¼‰
Level 1 ã® Step 2 ã¨åŒã˜

#### Step 4: Git ã§ã‚³ãƒ¼ãƒ‰å‰Šé™¤ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ»3åˆ†ï¼‰
```bash
cd /opt/onprem-infra-system/project-root-infra

# Unified Portalé–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ï¼ˆGitã‹ã‚‰ï¼‰
git rm -r services/unified-portal/backend/app/models/mail_*.py
git rm -r services/unified-portal/frontend/src/pages/Mail*.tsx
# ï¼ˆå¿…è¦ã«å¿œã˜ã¦ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ï¼‰

# ã‚³ãƒŸãƒƒãƒˆ
git commit -m "Rollback: Remove Unified Portal integration"
git push origin claude/unified-portal-update-013A39eBWkgFoYTVLvM3V19t
```

---

## ğŸ“ Level 3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚¹ãƒˆã‚¢ï¼ˆæœ€çµ‚æ‰‹æ®µï¼‰

### âš ï¸ è­¦å‘Š
- **ãƒ‡ãƒ¼ã‚¿æå¤±ã‚ã‚Š**: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å–å¾—å¾Œã®å…¨å¤‰æ›´ãŒå¤±ã‚ã‚Œã¾ã™
- **ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼åœæ­¢**: ãƒªã‚¹ãƒˆã‚¢ä¸­ã¯ãƒ¡ãƒ¼ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãŒã§ãã¾ã›ã‚“
- **æœ€çµ‚æ‰‹æ®µ**: ä»–ã®æ–¹æ³•ã§è§£æ±ºã§ããªã„å ´åˆã®ã¿å®Ÿæ–½

### å‰ææ¡ä»¶
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒç ´æãƒ»ä¸æ•´åˆçŠ¶æ…‹
- Level 1, 2 ã§è§£æ±ºä¸å¯èƒ½

### æ‰‹é †

#### Step 1: å…¨é–¢é€£ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ï¼ˆ5åˆ†ï¼‰
```bash
# Unified Portalåœæ­¢
cd /opt/onprem-infra-system/project-root-infra/services/unified-portal
docker compose down

# Flask usermgmtåœæ­¢
cd /opt/onprem-infra-system/project-root-infra/services/mailserver
docker compose stop usermgmt

# ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼åœæ­¢ï¼ˆèªè¨¼ã«å½±éŸ¿ã™ã‚‹ãŸã‚ï¼‰
docker compose stop postfix dovecot
```

#### Step 2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆç¾åœ¨ã®çŠ¶æ…‹ï¼‰ï¼ˆ3åˆ†ï¼‰
```bash
# å•é¡Œç™ºç”Ÿæ™‚ç‚¹ã®DBã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆå¾Œã§èª¿æŸ»å¯èƒ½ã«ã™ã‚‹ï¼‰
docker exec mailserver-mariadb-1 mysqldump \
  -u usermgmt -p<password> mailserver_usermgmt > \
  /mnt/backup-hdd/mailserver_usermgmt_corrupted_$(date +%Y%m%d_%H%M%S).sql
```

#### Step 3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚¹ãƒˆã‚¢ï¼ˆ10åˆ†ï¼‰
```bash
# ãƒªã‚¹ãƒˆã‚¢ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠï¼ˆæœ€æ–°ã®æ­£å¸¸ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
BACKUP_FILE="/mnt/backup-hdd/mailserver_usermgmt_pre-unified-portal_YYYYMMDD_HHMMSS.sql"

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚¹ãƒˆã‚¢
docker exec -i mailserver-mariadb-1 mysql \
  -u usermgmt -p<password> mailserver_usermgmt < ${BACKUP_FILE}

# ãƒªã‚¹ãƒˆã‚¢ç¢ºèª
docker exec -i mailserver-mariadb-1 mysql \
  -u usermgmt -p<password> \
  -e "SELECT COUNT(*) FROM mailserver_usermgmt.users;"
```

#### Step 4: ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•ï¼ˆ7åˆ†ï¼‰
```bash
cd /opt/onprem-infra-system/project-root-infra/services/mailserver

# ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
docker compose start postfix dovecot

# Flask usermgmtå†èµ·å‹•
docker compose start usermgmt

# å…¨ã‚³ãƒ³ãƒ†ãƒŠç¢ºèª
docker compose ps
```

#### Step 5: å‹•ä½œç¢ºèªï¼ˆ5åˆ†ï¼‰
```bash
# Flask usermgmt ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª
xdg-open http://172.20.0.80:5000

# ãƒ¡ãƒ¼ãƒ«èªè¨¼ãƒ†ã‚¹ãƒˆ
docker exec -it mailserver-dovecot-1 doveadm auth test \
  test@kuma8088.com password123
```

---

## ğŸ” ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¾Œã®æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Flask usermgmt æ­£å¸¸æ€§ç¢ºèª
- [ ] Web UI ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼ˆhttp://172.20.0.80:5000ï¼‰
- [ ] ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤º
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆæˆåŠŸ
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†æˆåŠŸ
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤æˆåŠŸ
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´æˆåŠŸ
- [ ] ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²ç¢ºèª

### ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼æ­£å¸¸æ€§ç¢ºèªï¼ˆLevel 3ã®ã¿ï¼‰
- [ ] Postfix èµ·å‹•ç¢ºèª
- [ ] Dovecot èµ·å‹•ç¢ºèª
- [ ] ãƒ¡ãƒ¼ãƒ«èªè¨¼ãƒ†ã‚¹ãƒˆæˆåŠŸ
- [ ] ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ†ã‚¹ãƒˆæˆåŠŸ
- [ ] ãƒ¡ãƒ¼ãƒ«å—ä¿¡ãƒ†ã‚¹ãƒˆæˆåŠŸ

### ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ç¢ºèª
```bash
# ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ç¢ºèª
docker exec mailserver-mariadb-1 mysql \
  -u usermgmt -p<password> \
  -e "SELECT COUNT(*) as user_count FROM mailserver_usermgmt.users;"

# ãƒ‰ãƒ¡ã‚¤ãƒ³æ•°ç¢ºèª
docker exec mailserver-mariadb-1 mysql \
  -u usermgmt -p<password> \
  -e "SELECT COUNT(*) as domain_count FROM mailserver_usermgmt.domains;"

# ç›£æŸ»ãƒ­ã‚°æœ€æ–°5ä»¶ç¢ºèª
docker exec mailserver-mariadb-1 mysql \
  -u usermgmt -p<password> \
  -e "SELECT * FROM mailserver_usermgmt.audit_logs ORDER BY created_at DESC LIMIT 5;"
```

---

## ğŸ“Š ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿæ–½è¨˜éŒ²ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### è¨˜éŒ²ãƒ•ã‚¡ã‚¤ãƒ«: `/var/log/unified-portal-rollback.log`

```
================================================================================
ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿæ–½è¨˜éŒ²
================================================================================
å®Ÿæ–½æ—¥æ™‚: YYYY-MM-DD HH:MM:SS
å®Ÿæ–½è€…: <Your Name>
ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¬ãƒ™ãƒ«: Level X

ã€å•é¡Œã®è©³ç´°ã€‘
- ç™ºç”Ÿæ—¥æ™‚: YYYY-MM-DD HH:MM:SS
- ç—‡çŠ¶: <å…·ä½“çš„ãªç—‡çŠ¶>
- å½±éŸ¿ç¯„å›²: <å½±éŸ¿ã‚’å—ã‘ãŸæ©Ÿèƒ½ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼>

ã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã€‘
- Level X æ‰‹é †ã‚’å®Ÿæ–½
- æ‰€è¦æ™‚é–“: XXåˆ†

ã€æ¤œè¨¼çµæœã€‘
- Flask usermgmt æ­£å¸¸æ€§: OK/NG
- ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼æ­£å¸¸æ€§: OK/NG
- ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§: OK/NG

ã€ãƒ‡ãƒ¼ã‚¿æå¤±ã€‘
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ—¥æ™‚: YYYY-MM-DD HH:MM:SS
- æå¤±æœŸé–“: Xæ™‚é–“/æ—¥

ã€ä»Šå¾Œã®å¯¾å¿œã€‘
- <å•é¡Œã®åŸå› èª¿æŸ»>
- <å†ç™ºé˜²æ­¢ç­–>

================================================================================
```

---

## ğŸ› ï¸ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¾Œã®å†æŒ‘æˆ¦æº–å‚™

### Level 1 ã‹ã‚‰ã®å†é–‹ï¼ˆUnified Portalå†èµ·å‹•ï¼‰
å•é¡Œã‚’ä¿®æ­£ã—ãŸå¾Œã€å†åº¦ Unified Portal ã‚’èµ·å‹•ã™ã‚‹å ´åˆï¼š

```bash
cd /opt/onprem-infra-system/project-root-infra/services/unified-portal

# ä¿®æ­£ã‚’é©ç”¨ï¼ˆã‚³ãƒ¼ãƒ‰ä¿®æ­£ã€è¨­å®šå¤‰æ›´ç­‰ï¼‰

# å†èµ·å‹•
docker compose up -d

# å‹•ä½œç¢ºèª
curl http://localhost:8000/health
xdg-open https://admin.kuma8088.com
```

### Level 2 ã‹ã‚‰ã®å†é–‹ï¼ˆå®Œå…¨å†æ§‹ç¯‰ï¼‰
Unified Portal ã‚’å‰Šé™¤ã—ãŸå¾Œã€å†åº¦æ§‹ç¯‰ã™ã‚‹å ´åˆï¼š

1. Webå´ã§ä¿®æ­£ç‰ˆã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
2. Git pull ã§æœ€æ–°ã‚³ãƒ¼ãƒ‰å–å¾—
3. [05_LOCAL_IMPLEMENTATION.md](05_LOCAL_IMPLEMENTATION.md) ã®æ‰‹é †ã‚’å†å®Ÿæ–½

### Level 3 ã‹ã‚‰ã®å†é–‹ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚¹ãƒˆã‚¢å¾Œï¼‰
ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¹ãƒˆã‚¢ã—ãŸå¾Œã€å†åº¦æŒ‘æˆ¦ã™ã‚‹å ´åˆï¼š

1. å•é¡Œã®æ ¹æœ¬åŸå› ã‚’ç‰¹å®š
2. ä¿®æ­£ç‰ˆã‚’ååˆ†ã«ãƒ†ã‚¹ãƒˆ
3. æ–°ã—ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å–å¾—
4. æ®µéšçš„ã«å†å°å…¥ï¼ˆä¸¦è¡Œç¨¼åƒæœŸé–“ã‚’é•·ã‚ã«ï¼‰

---

## ğŸ“ ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå¤±æ•—ã™ã‚‹å ´åˆ
ä»¥ä¸‹ã®é †ã§å¯¾å‡¦ã—ã¦ãã ã•ã„ï¼š

1. **Flask usermgmt ãŒèµ·å‹•ã—ãªã„**
   ```bash
   # ãƒ­ã‚°ç¢ºèª
   docker logs mailserver-usermgmt-1

   # ã‚³ãƒ³ãƒ†ãƒŠå†èµ·å‹•
   docker restart mailserver-usermgmt-1

   # ãã‚Œã§ã‚‚å¤±æ•—ã™ã‚‹å ´åˆ
   cd /opt/onprem-infra-system/project-root-infra/services/mailserver
   docker compose restart usermgmt
   ```

2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒç ´æã—ã¦ã„ã‚‹**
   - Level 3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚¹ãƒˆã‚¢ã‚’å®Ÿæ–½
   - ãã‚Œã§ã‚‚å¤±æ•—ã™ã‚‹å ´åˆã¯ `/mnt/backup-hdd/mailserver/daily/` ã‹ã‚‰æœ€æ–°ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½¿ç”¨

3. **å…¨ã¦ãŒå¤±æ•—ã™ã‚‹å ´åˆ**
   - `/mnt/backup-hdd/` ã‹ã‚‰å…¨ä½“ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ãƒªã‚¹ãƒˆã‚¢
   - [services/mailserver/scripts/restore-mailserver.sh](../../../mailserver/scripts/restore-mailserver.sh) ã‚’ä½¿ç”¨

---

## âœ… ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Œäº†åŸºæº–

ä»¥ä¸‹ã®å…¨ã¦ã‚’æº€ãŸã—ãŸå ´åˆã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Œäº†ã¨ã¿ãªã—ã¾ã™ï¼š

- [ ] Flask usermgmt ãŒæ­£å¸¸ç¨¼åƒ
- [ ] å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼CRUDæ“ä½œãŒæ­£å¸¸å‹•ä½œ
- [ ] ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ï¼ˆPostfix/Dovecotï¼‰ãŒæ­£å¸¸ç¨¼åƒ
- [ ] ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãŒç¢ºèªã§ããŸ
- [ ] ç›£æŸ»ãƒ­ã‚°ãŒæ­£å¸¸ã«è¨˜éŒ²ã•ã‚Œã‚‹
- [ ] ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨˜éŒ²ã‚’ä½œæˆã—ãŸ
- [ ] é–¢ä¿‚è€…ã«é€šçŸ¥ã—ãŸ

---

## ğŸ“ æ•™è¨“ãƒ»æ”¹å–„ç‚¹è¨˜éŒ²

ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿæ–½å¾Œã€å¿…ãšä»¥ä¸‹ã‚’è¨˜éŒ²ã—ã¦ãã ã•ã„ï¼š

### å•é¡Œã®æ ¹æœ¬åŸå› 
```
- æŠ€è¡“çš„åŸå› : <å…·ä½“çš„ãªåŸå› >
- è¨­è¨ˆä¸Šã®å•é¡Œ: <ã‚ã‚Œã°è¨˜è¼‰>
- ãƒ†ã‚¹ãƒˆä¸è¶³: <è¦‹é€ƒã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹>
```

### å†ç™ºé˜²æ­¢ç­–
```
- ã‚³ãƒ¼ãƒ‰ä¿®æ­£: <å¿…è¦ãªä¿®æ­£>
- ãƒ†ã‚¹ãƒˆè¿½åŠ : <è¿½åŠ ã™ã¹ããƒ†ã‚¹ãƒˆ>
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°: <æ›´æ–°ã™ã¹ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ>
```

### æ¬¡å›ã®æ”¹å–„ç‚¹
```
- ä¸¦è¡Œç¨¼åƒæœŸé–“: Xæ—¥é–“ â†’ Yæ—¥é–“ã«å»¶é•·
- ãƒ†ã‚¹ãƒˆå¼·åŒ–: <è¿½åŠ ã™ã¹ããƒ†ã‚¹ãƒˆ>
- ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°å¼·åŒ–: <è¿½åŠ ã™ã¹ãç›£è¦–é …ç›®>
```

---

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**:
- ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¾Œã€å•é¡Œã‚’ä¿®æ­£ã—ã¦å†æŒ‘æˆ¦ã™ã‚‹å ´åˆ: [05_LOCAL_IMPLEMENTATION.md](05_LOCAL_IMPLEMENTATION.md)
- ä¸¦è¡Œç¨¼åƒã‚’ç¶™ç¶šã™ã‚‹å ´åˆ: Flask usermgmt ã§é‹ç”¨ç¶™ç¶š

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [services/mailserver/troubleshoot/README.md](../../../mailserver/troubleshoot/README.md) - Mailserverãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- [services/mailserver/scripts/restore-mailserver.sh](../../../mailserver/scripts/restore-mailserver.sh) - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒªã‚¹ãƒˆã‚¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
