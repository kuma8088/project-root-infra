# テスト計画書

**作成日**: 2025-11-10
**最終更新**: 2025-11-10
**ステータス**: 📝 作成中

---

## 📋 テスト概要

### 目的

ブログシステムの各機能が正常に動作することを確認し、本番環境での安定稼働を保証する。

### スコープ

- **対象環境**: Dell WorkStation Docker Compose環境
- **対象サイト**: 全16 WordPressサイト
- **テスト期間**: Phase別に実施

---

## 🧪 テスト分類

### 1. 機能テスト

#### 1.1 フロントエンド表示テスト

**目的**: 各サイトのトップページとコンテンツページが正常に表示されることを確認

**テスト項目**:

| # | テスト項目 | 確認方法 | 期待結果 |
|---|-----------|---------|---------|
| 1.1.1 | トップページ表示 | ブラウザアクセス | HTTP 200、レイアウト正常 |
| 1.1.2 | 静的ファイル読み込み | DevTools Network | CSS/JS/画像が200で取得 |
| 1.1.3 | 画像表示 | 目視確認 | アイキャッチ・メディア画像表示 |
| 1.1.4 | レスポンシブデザイン | モバイル/タブレット表示 | 各デバイスで適切に表示 |

**対象サイト**: 全16サイト

#### 1.2 WordPress管理画面テスト

**目的**: WordPress管理機能が正常に動作することを確認

**テスト項目**:

| # | テスト項目 | 確認方法 | 期待結果 |
|---|-----------|---------|---------|
| 1.2.1 | ログイン | /wp-admin/アクセス | ログイン成功 |
| 1.2.2 | ダッシュボード表示 | 管理画面確認 | エラーなし |
| 1.2.3 | 投稿一覧表示 | 投稿メニュー | 既存投稿が表示 |
| 1.2.4 | メディア一覧表示 | メディアメニュー | サムネイル表示 |
| 1.2.5 | プラグイン一覧 | プラグインメニュー | プラグイン情報表示 |

**対象サイト**: 代表5サイト（各ドメインから1サイトずつ）

#### 1.3 Elementor機能テスト

**目的**: Elementorページビルダーが正常に動作することを確認

**テスト項目**:

| # | テスト項目 | 確認方法 | 期待結果 |
|---|-----------|---------|---------|
| 1.3.1 | Elementor編集画面起動 | 「Elementorで編集」クリック | 編集画面表示 |
| 1.3.2 | プレビュー機能 | プレビューボタンクリック | プレビュー画面表示 |
| 1.3.3 | ウィジェット追加 | ドラッグ&ドロップ | ウィジェット配置成功 |
| 1.3.4 | CSS/JS読み込み | DevTools確認 | Elementor関連ファイル200 |
| 1.3.5 | 保存機能 | 保存ボタンクリック | 変更が保存される |

**対象サイト**: Elementor使用サイト（10サイト）

**注意**: Phase 011対応前は失敗する可能性あり

#### 1.4 メール送信テスト

**目的**: WordPress経由のメール送信が正常に動作することを確認

**テスト項目**:

| # | テスト項目 | 確認方法 | 期待結果 |
|---|-----------|---------|---------|
| 1.4.1 | パスワードリセット | パスワード忘れ機能 | メール受信 |
| 1.4.2 | コメント通知 | テストコメント投稿 | 管理者にメール通知 |
| 1.4.3 | メール送信元 | 受信メールヘッダ確認 | noreply@{domain} |
| 1.4.4 | SPF/DKIM認証 | メールヘッダ確認 | 認証PASS |

**対象サイト**: 代表3サイト（各ドメインから1サイトずつ）

**前提条件**: WP Mail SMTP設定完了（✅ 2025-11-10完了）

---

### 2. パフォーマンステスト

#### 2.1 ページ読み込み速度テスト

**目的**: 各サイトの応答速度が許容範囲内であることを確認

**テスト項目**:

| # | テスト項目 | 確認方法 | 期待結果 |
|---|-----------|---------|---------|
| 2.1.1 | トップページTTFB | Chrome DevTools | < 1秒 |
| 2.1.2 | トップページFCP | Lighthouse | < 2秒 |
| 2.1.3 | トップページLCP | Lighthouse | < 3秒 |
| 2.1.4 | 画像最適化 | Lighthouse | スコア80以上 |

**対象サイト**: 代表5サイト

#### 2.2 データベースパフォーマンステスト

**目的**: データベース応答速度が許容範囲内であることを確認

**テスト項目**:

| # | テスト項目 | 確認方法 | 期待結果 |
|---|-----------|---------|---------|
| 2.2.1 | クエリ応答時間 | Query Monitor | 平均 < 50ms |
| 2.2.2 | スロークエリ | MariaDBスロークエリログ | なし |

---

### 3. セキュリティテスト

#### 3.1 WordPress セキュリティテスト

**目的**: WordPressの基本的なセキュリティ設定が適切であることを確認

**テスト項目**:

| # | テスト項目 | 確認方法 | 期待結果 |
|---|-----------|---------|---------|
| 3.1.1 | wp-config.php保護 | URLアクセス | 403 Forbidden |
| 3.1.2 | .htaccess保護 | URLアクセス | 403 Forbidden |
| 3.1.3 | ディレクトリリスティング | /wp-content/アクセス | 403 Forbidden |
| 3.1.4 | ファイルアップロード制限 | PHP/実行ファイルアップロード | 拒否される |

**対象サイト**: 全16サイト（自動テスト可能）

#### 3.2 SSL/TLS テスト

**目的**: Cloudflare経由のSSL/TLS設定が適切であることを確認

**テスト項目**:

| # | テスト項目 | 確認方法 | 期待結果 |
|---|-----------|---------|---------|
| 3.2.1 | HTTPS接続 | ブラウザアクセス | 証明書有効 |
| 3.2.2 | HTTP→HTTPS自動転送 | HTTPアクセス | 301リダイレクト |
| 3.2.3 | 混在コンテンツなし | DevTools Console | エラーなし |

**対象サイト**: 全16サイト

---

### 4. 統合テスト

#### 4.1 Cloudflare Tunnel統合テスト

**目的**: Cloudflare Tunnelを経由したアクセスが正常に動作することを確認

**テスト項目**:

| # | テスト項目 | 確認方法 | 期待結果 |
|---|-----------|---------|---------|
| 4.1.1 | 外部アクセス | 異なるネットワークから | 正常アクセス |
| 4.1.2 | Tunnel健全性 | cloudflaredログ | エラーなし |
| 4.1.3 | CDN動作 | レスポンスヘッダ確認 | CF-Cache-Status表示 |

**対象サイト**: 全16サイト

#### 4.2 Mailserver統合テスト

**目的**: Mailserver経由のメール送信が正常に動作することを確認

**テスト項目**:

| # | テスト項目 | 確認方法 | 期待結果 |
|---|-----------|---------|---------|
| 4.2.1 | SMTP接続 | WordPress→Postfix | 接続成功 |
| 4.2.2 | SendGrid転送 | Postfix→SendGrid | 転送成功 |
| 4.2.3 | 配信確認 | Gmail受信確認 | 受信トレイ到達 |

**対象サイト**: 代表3サイト

---

## 🔍 Phase 011 関連テスト

### サブディレクトリサイト検証テスト

**目的**: Phase 011起票問題の影響範囲を正確に把握する

#### 各ドメイン配下 /test/ ディレクトリサイト確認

**テスト対象**:

| # | サイトURL | 作成状況 | テスト内容 |
|---|----------|---------|-----------|
| 1 | https://blog.kuma8088.com/test/ | ✅ 作成済み | フロント表示、管理画面、Elementorプレビュー |
| 2 | https://blog.fx-trader-life.com/test/ | 📝 作成予定 | 同上 |
| 3 | https://blog.webmakeprofit.org/test/ | 📝 作成予定 | 同上 |
| 4 | https://blog.webmakesprofit.com/test/ | 📝 作成予定 | 同上 |
| 5 | https://blog.toyota-phv.jp/test/ | 📝 作成予定 | 同上 |

**テスト項目**:

| # | テスト項目 | 確認内容 | 期待結果 |
|---|-----------|---------|---------|
| T1 | フロントページ表示 | CSS/JS/画像読み込み | 正常表示 |
| T2 | WordPress管理画面 | ログイン・ダッシュボード | 正常動作 |
| T3 | Elementorプレビュー | プレビュー機能 | 正常動作 |
| T4 | 静的ファイルパス | DevTools Network | 正しいパス解決 |
| T5 | Ajax動作 | admin-ajax.php | 正常応答 |

**判定基準**:
- ✅ 独立ドメインサイト（fx-trader-life, webmakeprofit等）: すべて正常動作すること
- ⚠️ サブディレクトリサイト（kuma8088.com/test）: Phase 011対応前は一部機能不全の可能性あり

**実施タイミング**: Phase 011-A, B, C各実装後

---

## 📊 テスト実施スケジュール

### Phase A-1完了後（✅ 完了）

- [x] 基本的なフロントエンド表示テスト
- [x] WordPress管理画面アクセステスト
- [x] URL正常性確認

### Phase 011対応前（現在）

- [ ] サブディレクトリサイト詳細検証
- [ ] 各ドメイン /test/ サイト作成と確認
- [ ] Elementor機能詳細テスト
- [ ] 静的ファイルパス検証

### Phase 011-A完了後

- [ ] Nginx設定修正後の再テスト
- [ ] フロントページ表示確認（全サイト）

### Phase 011-B完了後

- [ ] URL置換後の全機能テスト
- [ ] Elementorプレビュー機能テスト
- [ ] Cloudflare WAF動作確認

### Phase 011-C完了後（恒久対応）

- [ ] 独立サブドメイン化後の全機能テスト
- [ ] パフォーマンステスト
- [ ] セキュリティテスト
- [ ] 統合テスト（Cloudflare + Mailserver）

### Phase A-2実装時

- [ ] バックアップ・リストア機能テスト

---

## 🛠️ テストツール

### 使用ツール

| ツール | 用途 | 実装状況 |
|-------|------|---------|
| Chrome DevTools | パフォーマンス、Network確認 | ✅ 利用可能 |
| Lighthouse | パフォーマンス測定 | ✅ 利用可能 |
| MCP Playwright | 自動E2Eテスト | ✅ 利用可能 |
| wp-cli | WordPress操作自動化 | ✅ 利用可能 |
| curl | エンドポイントテスト | ✅ 利用可能 |

### 自動テストスクリプト（予定）

```bash
# 全サイトHTTPステータステスト
./scripts/test-all-sites-http.sh

# 全サイトWordPressバージョン確認
./scripts/test-all-sites-wp-version.sh

# 全サイトメール送信テスト
./scripts/test-all-sites-email.sh
```

---

## 📝 テスト記録

### テスト実施ログ

各テスト実施時に記録する情報:

- **実施日時**
- **テスト担当者**
- **テスト環境** (Docker version, OS version等)
- **テスト結果** (PASS/FAIL/SKIP)
- **問題詳細** (FAIL時のエラーメッセージ、スクリーンショット)
- **対処内容**

### テストレポート保存先

- `/opt/onprem-infra-system/project-root-infra/claudedocs/test-reports/`
- ファイル名形式: `test-report-YYYYMMDD-PHASE.md`

---

## 🔗 関連ドキュメント

- [01_requirements.md](./01_requirements.md) - 要件定義
- [02_design.md](./02_design.md) - システム設計
- [phase-011-subdirectory-display-issue.md](./phase-011-subdirectory-display-issue.md) - Phase 011詳細

---

**作成者**: Claude Code (AI Assistant)
**最終更新**: 2025-11-10
