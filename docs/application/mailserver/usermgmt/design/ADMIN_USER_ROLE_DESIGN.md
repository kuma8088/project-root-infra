# ç®¡ç†è€…ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™åˆ†é›¢è¨­è¨ˆ

**ä½œæˆæ—¥**: 2025-11-05
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è¨­è¨ˆä¸­ (Phase 11 - Extended è¿½åŠ æ©Ÿèƒ½)

---

## ğŸ“‹ è¦ä»¶

### ç¾çŠ¶ã®èª²é¡Œ
- å…¨ã¦ã® `users` ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç®¡ç†ç”»é¢ã«ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½
- æ¨©é™ã®åŒºåˆ¥ãŒãªãã€èª°ã§ã‚‚å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç®¡ç†ã§ãã‚‹
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ï¼šãƒ¡ãƒ¼ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç®¡ç†æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

### ç›®æ¨™
- **ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼ (admin)**: 1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã€å…¨æ©Ÿèƒ½åˆ©ç”¨å¯èƒ½
- **é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ (user)**: ãã®ä»–å…¨ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€æ©Ÿèƒ½åˆ¶é™ã‚ã‚Š
- **ã‚¿ã‚°è­˜åˆ¥**: `admin` / `user` ã§æ¨©é™ã‚’è­˜åˆ¥
- **æ©Ÿèƒ½åˆ†é›¢**: æ¨©é™ã«å¿œã˜ã¦åˆ©ç”¨å¯èƒ½ãªæ©Ÿèƒ½ã‚’åˆ¶é™

---

## ğŸ—ï¸ è¨­è¨ˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒæ¯”è¼ƒ

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1: `users` ãƒ†ãƒ¼ãƒ–ãƒ«ã« `is_admin` ã‚«ãƒ©ãƒ è¿½åŠ  âœ… æ¨å¥¨

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ã‚·ãƒ³ãƒ—ãƒ«ã§å®Ÿè£…ã‚³ã‚¹ãƒˆãŒä½ã„
- æ—¢å­˜ã®ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã‚’æ´»ç”¨
- ç®¡ç†è€…1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã¨ã„ã†åˆ¶ç´„ã«é©åˆ

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- å°†æ¥çš„ã«è¤‡æ•°ã®æ¨©é™ã‚¿ã‚¤ãƒ—ãŒå¿…è¦ã«ãªã£ãŸå ´åˆã€æ‹¡å¼µæ€§ãŒä½ã„

**ãƒ†ãƒ¼ãƒ–ãƒ«å¤‰æ›´**:
```sql
ALTER TABLE users ADD COLUMN is_admin BOOLEAN DEFAULT FALSE NOT NULL;
CREATE UNIQUE INDEX idx_users_single_admin ON users (is_admin) WHERE is_admin = TRUE;
```

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ2: `admins` ãƒ†ãƒ¼ãƒ–ãƒ«åˆ†é›¢

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ç®¡ç†è€…ã¨é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å®Œå…¨åˆ†é›¢
- ãƒ¡ãƒ¼ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®å½±éŸ¿ãªã—

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå¢—ãˆã‚‹ï¼ˆè¤‡é›‘åŒ–ï¼‰
- æ—¢å­˜ã®ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿæ§‹ã‚’å¤§å¹…ã«å¤‰æ›´ãŒå¿…è¦

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ3: Role ãƒ™ãƒ¼ã‚¹æ¨©é™ç®¡ç† (RBAC)

**ãƒ¡ãƒªãƒƒãƒˆ**:
- å°†æ¥çš„ãªæ‹¡å¼µæ€§ãŒé«˜ã„
- è¤‡æ•°ã®æ¨©é™ã‚¿ã‚¤ãƒ—ã«å¯¾å¿œå¯èƒ½

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- ç¾åœ¨ã®è¦ä»¶ã«å¯¾ã—ã¦ã‚ªãƒ¼ãƒãƒ¼ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°
- å®Ÿè£…ã‚³ã‚¹ãƒˆãŒé«˜ã„

**çµè«–**: **ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1 ã‚’æ¡ç”¨** (ã‚·ãƒ³ãƒ—ãƒ«ã§è¦ä»¶ã«é©åˆ)

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 1. `users` ãƒ†ãƒ¼ãƒ–ãƒ«å¤‰æ›´

**æ–°è¦ã‚«ãƒ©ãƒ **:
```sql
-- ç®¡ç†è€…ãƒ•ãƒ©ã‚°
is_admin BOOLEAN DEFAULT FALSE NOT NULL
```

**åˆ¶ç´„**:
```sql
-- ç®¡ç†è€…ã¯1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ï¼ˆPostgreSQL/MySQL 8.0.13+ï¼‰
CREATE UNIQUE INDEX idx_users_single_admin ON users (is_admin) WHERE is_admin = TRUE;
```

**ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã®ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ **:
```
users
â”œâ”€â”€ id (INT, PRIMARY KEY, AUTO_INCREMENT)
â”œâ”€â”€ email (VARCHAR(255), UNIQUE, NOT NULL)
â”œâ”€â”€ password_hash (VARCHAR(255), NOT NULL)
â”œâ”€â”€ domain_id (INT, FOREIGN KEY -> domains.id)
â”œâ”€â”€ quota (INT, DEFAULT 1024)
â”œâ”€â”€ enabled (BOOLEAN, DEFAULT TRUE)
â”œâ”€â”€ is_admin (BOOLEAN, DEFAULT FALSE, NOT NULL)  â† æ–°è¦
â”œâ”€â”€ created_at (TIMESTAMP)
â””â”€â”€ updated_at (TIMESTAMP)
```

### 2. åˆæœŸãƒ‡ãƒ¼ã‚¿è¨­å®š

æ—¢å­˜ã® `admin@kuma8088.com` ã‚’ç®¡ç†è€…ã«è¨­å®š:
```sql
UPDATE users SET is_admin = TRUE WHERE email = 'admin@kuma8088.com';
```

---

## ğŸ” æ©Ÿèƒ½åˆ†é›¢è¨­è¨ˆ

### ç®¡ç†è€… (admin) ã®æ¨©é™

**ãƒ•ãƒ«ã‚¢ã‚¯ã‚»ã‚¹**:
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤º
- âœ… æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ç·¨é›†
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æœ‰åŠ¹åŒ–/ç„¡åŠ¹åŒ–
- âœ… ç›£æŸ»ãƒ­ã‚°é–²è¦§

**è¿½åŠ æ©Ÿèƒ½**:
- âœ… è‡ªåˆ†ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
- âœ… è‡ªåˆ†ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›´

### é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ (user) ã®æ¨©é™

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã®ã¿** âœ… æ¨å¥¨
- âœ… è‡ªåˆ†ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã®ã¿
- âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤ºä¸å¯
- âŒ ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œä¸å¯

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: èª­ã¿å–ã‚Šå°‚ç”¨**
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤ºï¼ˆèª­ã¿å–ã‚Šã®ã¿ï¼‰
- âœ… è‡ªåˆ†ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
- âŒ ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç·¨é›†ãƒ»å‰Šé™¤ä¸å¯

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³3: å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯**
- âŒ ç®¡ç†ç”»é¢ã¸ã®ãƒ­ã‚°ã‚¤ãƒ³è‡ªä½“ã‚’æ‹’å¦
- âœ… IMAPãƒ¡ãƒ¼ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã®ã¿

---

## ğŸ¯ æ¨å¥¨è¨­è¨ˆ

### æ¨©é™ãƒ¢ãƒ‡ãƒ«

| æ¨©é™ | ç®¡ç†è€… (admin) | é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ (user) |
|------|----------------|---------------------|
| ãƒ­ã‚°ã‚¤ãƒ³ | âœ… | âœ… (ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã®ã¿) |
| ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰é–²è¦§ | âœ… | âŒ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ | âœ… | âŒ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ | âœ… | âŒ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›† | âœ… | âŒ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ | âœ… | âŒ |
| ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ | âœ… | âŒ |
| è‡ªåˆ†ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ | âœ… | âœ… |
| ç›£æŸ»ãƒ­ã‚°é–²è¦§ | âœ… | âŒ |

### UI ãƒ•ãƒ­ãƒ¼

**ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³å¾Œ**:
```
ãƒ­ã‚°ã‚¤ãƒ³ â†’ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’ å…¨æ©Ÿèƒ½ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
```

**é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³å¾Œ**:
```
ãƒ­ã‚°ã‚¤ãƒ³ â†’ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ç”»é¢ â†’ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
```

---

## ğŸ’» å®Ÿè£…è¨­è¨ˆ

### 1. ãƒ¢ãƒ‡ãƒ«å¤‰æ›´

**`app/models/user.py`**:
```python
class User(UserMixin, db.Model):
    __tablename__ = 'users'

    id = db.Column(db.Integer, primary_key=True)
    email = db.Column(db.String(255), unique=True, nullable=False, index=True)
    password_hash = db.Column(db.String(255), nullable=False)
    domain_id = db.Column(db.Integer, db.ForeignKey('domains.id'), nullable=False)
    quota = db.Column(db.Integer, default=1024, nullable=False)
    enabled = db.Column(db.Boolean, default=True, nullable=False)
    is_admin = db.Column(db.Boolean, default=False, nullable=False)  # æ–°è¦
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
```

### 2. èªå¯ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼

**`app/decorators.py` (æ–°è¦)**:
```python
from functools import wraps
from flask import abort, redirect, url_for, flash
from flask_login import current_user

def admin_required(f):
    """ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ãªãƒ«ãƒ¼ãƒˆã‚’ä¿è­·"""
    @wraps(f)
    def decorated_function(*args, **kwargs):
        if not current_user.is_authenticated:
            return redirect(url_for('auth.login'))
        if not current_user.is_admin:
            flash('ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™ã€‚', 'error')
            abort(403)
        return f(*args, **kwargs)
    return decorated_function

def self_or_admin_required(f):
    """è‡ªåˆ†è‡ªèº«ã¾ãŸã¯ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½"""
    @wraps(f)
    def decorated_function(*args, **kwargs):
        if not current_user.is_authenticated:
            return redirect(url_for('auth.login'))

        # URLã‹ã‚‰å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—ï¼ˆä¾‹: /users/<user_id>/passwordï¼‰
        user_id = kwargs.get('user_id')

        # è‡ªåˆ†è‡ªèº«ã¾ãŸã¯ç®¡ç†è€…ãªã‚‰OK
        if current_user.is_admin or (user_id and current_user.id == int(user_id)):
            return f(*args, **kwargs)

        flash('ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚', 'error')
        abort(403)
    return decorated_function
```

### 3. ãƒ«ãƒ¼ãƒˆä¿è­·

**`app/routes/users.py`**:
```python
from app.decorators import admin_required, self_or_admin_required

@bp.route('/users')
@login_required
@admin_required  # ç®¡ç†è€…ã®ã¿
def list_users():
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤º
    pass

@bp.route('/users/create', methods=['GET', 'POST'])
@login_required
@admin_required  # ç®¡ç†è€…ã®ã¿
def create_user():
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
    pass

@bp.route('/users/<int:user_id>/password', methods=['GET', 'POST'])
@login_required
@self_or_admin_required  # è‡ªåˆ†ã¾ãŸã¯ç®¡ç†è€…
def change_password(user_id):
    # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
    pass
```

### 4. ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

**`app/routes/auth.py`**:
```python
@auth_bp.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        # ... èªè¨¼å‡¦ç† ...

        login_user(user, remember=True)

        # ç®¡ç†è€… â†’ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
        if user.is_admin:
            return redirect(url_for('dashboard'))

        # é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ç”»é¢
        else:
            flash('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚', 'info')
            return redirect(url_for('users.change_password', user_id=user.id))

    return render_template('login.html')
```

### 5. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåˆ†å²

**`templates/dashboard.html`**:
```jinja2
{% if current_user.is_admin %}
  <!-- ç®¡ç†è€…ç”¨: å…¨æ©Ÿèƒ½è¡¨ç¤º -->
  <a href="{{ url_for('users.list_users') }}">ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</a>
  <a href="{{ url_for('users.create_user') }}">æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ</a>
{% else %}
  <!-- é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼: åˆ¶é™ã•ã‚ŒãŸæ©Ÿèƒ½ã®ã¿ -->
  <p>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã®ã¿å¯èƒ½ã§ã™ã€‚</p>
  <a href="{{ url_for('users.change_password', user_id=current_user.id) }}">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</a>
{% endif %}
```

---

## ğŸ—‚ï¸ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †

### Phase 11-1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

**1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³SQLä½œæˆ**:
```sql
-- migrations/011_add_is_admin_column.sql

-- Step 1: ã‚«ãƒ©ãƒ è¿½åŠ 
ALTER TABLE users ADD COLUMN is_admin BOOLEAN DEFAULT FALSE NOT NULL;

-- Step 2: æ—¢å­˜ã® admin@kuma8088.com ã‚’ç®¡ç†è€…ã«è¨­å®š
UPDATE users SET is_admin = TRUE WHERE email = 'admin@kuma8088.com';

-- Step 3: åˆ¶ç´„è¿½åŠ ï¼ˆç®¡ç†è€…ã¯1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ï¼‰
-- MySQL 8.0.13+ ã®å ´åˆ
-- CREATE UNIQUE INDEX idx_users_single_admin ON users (is_admin) WHERE is_admin = TRUE;

-- MySQL 8.0.12 ä»¥å‰ã®å ´åˆã¯ãƒˆãƒªã‚¬ãƒ¼ã§åˆ¶å¾¡
DELIMITER $$
CREATE TRIGGER trg_single_admin_check
BEFORE UPDATE ON users
FOR EACH ROW
BEGIN
    IF NEW.is_admin = TRUE AND OLD.is_admin = FALSE THEN
        IF (SELECT COUNT(*) FROM users WHERE is_admin = TRUE) > 0 THEN
            SIGNAL SQLSTATE '45000'
            SET MESSAGE_TEXT = 'ç®¡ç†è€…ã¯1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿è¨­å®šå¯èƒ½ã§ã™';
        END IF;
    END IF;
END$$
DELIMITER ;
```

**2. ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯SQL**:
```sql
-- migrations/011_rollback.sql

DROP TRIGGER IF EXISTS trg_single_admin_check;
ALTER TABLE users DROP COLUMN is_admin;
```

### Phase 11-2: ãƒ¢ãƒ‡ãƒ«ãƒ»ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼å®Ÿè£…

1. `app/models/user.py` ã« `is_admin` ã‚«ãƒ©ãƒ è¿½åŠ 
2. `app/decorators.py` ä½œæˆï¼ˆ`admin_required`, `self_or_admin_required`ï¼‰
3. æ—¢å­˜ãƒ«ãƒ¼ãƒˆã«èªå¯ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼é©ç”¨

### Phase 11-3: UI èª¿æ•´

1. ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆåˆ†å²
2. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®è¡¨ç¤ºåˆ†å²
3. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¡¨ç¤ºåˆ¶å¾¡

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¨ˆç”»

### ç®¡ç†è€…æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- âœ… ç®¡ç†è€…ã§ãƒ­ã‚°ã‚¤ãƒ³ â†’ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤º
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- âœ… ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
- âœ… è‡ªåˆ†ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´

### é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- âœ… é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³ â†’ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ç”»é¢è¡¨ç¤º
- âœ… è‡ªåˆ†ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´æˆåŠŸ
- âŒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦ï¼ˆ403ï¼‰
- âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦ï¼ˆ403ï¼‰
- âŒ ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´æ‹’å¦ï¼ˆ403ï¼‰

### åˆ¶ç´„ãƒ†ã‚¹ãƒˆ
- âŒ 2äººç›®ã®ç®¡ç†è€…ä½œæˆè©¦è¡Œ â†’ ã‚¨ãƒ©ãƒ¼
- âœ… ç®¡ç†è€…ãƒ•ãƒ©ã‚°ã®åˆ‡ã‚Šæ›¿ãˆ

---

## ğŸ“ è³ªå•ãƒ»ç¢ºèªäº‹é …

### 1. é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ç¯„å›²

ä»¥ä¸‹ã®ã©ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæœ›ã¾ã—ã„ã§ã™ã‹ï¼Ÿ

**A. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã®ã¿** âœ… æ¨å¥¨
- ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€è‡ªåˆ†ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ç”»é¢ã®ã¿è¡¨ç¤º
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯

**B. èª­ã¿å–ã‚Šå°‚ç”¨**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’é–²è¦§å¯èƒ½ï¼ˆç·¨é›†ãƒ»å‰Šé™¤ã¯ä¸å¯ï¼‰
- è‡ªåˆ†ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã¯å¯èƒ½

**C. ãƒ­ã‚°ã‚¤ãƒ³ä¸å¯**
- ç®¡ç†ç”»é¢ã¸ã®ãƒ­ã‚°ã‚¤ãƒ³è‡ªä½“ã‚’æ‹’å¦
- IMAPãƒ¡ãƒ¼ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã®ã¿

### 2. ç®¡ç†è€…ã®å¤‰æ›´

ç®¡ç†è€…ã‚’åˆ¥ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¤‰æ›´ã™ã‚‹æ©Ÿèƒ½ã¯å¿…è¦ã§ã™ã‹ï¼Ÿ

**A. ç®¡ç†ç”»é¢ã§å¤‰æ›´å¯èƒ½**
- æ—¢å­˜ã®ç®¡ç†è€…ãŒæ–°ã—ã„ç®¡ç†è€…ã‚’æŒ‡å®š
- è‡ªå‹•çš„ã«æ—§ç®¡ç†è€…ã¯é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é™æ ¼

**B. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç›´æ¥å¤‰æ›´ã®ã¿**
- ç®¡ç†ç”»é¢ã‹ã‚‰ã¯å¤‰æ›´ä¸å¯
- å¿…è¦æ™‚ã«SQLã§æ‰‹å‹•å¤‰æ›´

### 3. ç›£æŸ»ãƒ­ã‚°ã¸ã®è¨˜éŒ²

æ¨©é™å¤‰æ›´æ“ä½œã‚’ç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ²ã—ã¾ã™ã‹ï¼Ÿ

- âœ… ç®¡ç†è€…æ¨©é™ã®ä»˜ä¸/å‰¥å¥ª
- âœ… æ¨©é™ä¸è¶³ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦

---

## ğŸš€ å®Ÿè£…å„ªå…ˆé †ä½

### Phase 11-1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŸºç›¤ (0.5æ™‚é–“)
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³SQLä½œæˆ
- `is_admin` ã‚«ãƒ©ãƒ è¿½åŠ 
- åˆ¶ç´„è¨­å®š

### Phase 11-2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£… (1æ™‚é–“)
- ãƒ¢ãƒ‡ãƒ«æ›´æ–°
- ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼å®Ÿè£…
- ãƒ«ãƒ¼ãƒˆä¿è­·

### Phase 11-3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èª¿æ•´ (0.5æ™‚é–“)
- ãƒ­ã‚°ã‚¤ãƒ³å¾Œãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
- UIåˆ†å²å®Ÿè£…

### Phase 11-4: ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ (0.5æ™‚é–“)
- ç®¡ç†è€…æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- åˆ¶ç´„ãƒ†ã‚¹ãƒˆ

**åˆè¨ˆè¦‹ç©ã‚‚ã‚Š**: 2.5æ™‚é–“

---

## ğŸ“Œ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ä»¥ä¸‹ã®ç¢ºèªãŒå–ã‚ŒãŸã‚‰å®Ÿè£…ã‚’é–‹å§‹ã—ã¾ã™ï¼š

1. âœ… é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ç¯„å›²ï¼ˆA/B/Cã‹ã‚‰é¸æŠï¼‰
2. âœ… ç®¡ç†è€…å¤‰æ›´æ©Ÿèƒ½ã®è¦å¦ï¼ˆA/B ã‹ã‚‰é¸æŠï¼‰
3. âœ… ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²ã®è¦å¦

ç¢ºèªå¾Œã€Phase 11 ã¨ã—ã¦å®Ÿè£…ã‚’é€²ã‚ã¾ã™ã€‚
