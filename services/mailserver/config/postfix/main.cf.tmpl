# 基本設定
myhostname = {{MAIL_HOSTNAME}}
mydomain = {{MAIL_DOMAIN}}
myorigin = $mydomain
mydestination =

# ネットワーク設定
inet_interfaces = all
inet_protocols = ipv4
mynetworks = 127.0.0.0/8, 172.20.0.0/24

# SendGrid SMTP Relay設定
relayhost = {{POSTFIX_RELAYHOST}}
smtp_sasl_auth_enable = yes
smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd
smtp_sasl_security_options = noanonymous
smtp_tls_security_level = encrypt
smtp_tls_note_starttls_offer = yes

# メールボックス設定（受信はDovecot LMTP経由）
virtual_mailbox_domains = {{VIRTUAL_MAILBOX_DOMAINS}}
virtual_transport = lmtp:unix:private/dovecot-lmtp

# メッセージサイズ制限
message_size_limit = {{POSTFIX_MESSAGE_SIZE_LIMIT}}

# SMTPD設定（Port 587受信用）
smtpd_relay_restrictions = permit_mynetworks, defer_unauth_destination
smtpd_sasl_auth_enable = no
smtpd_tls_security_level = may
smtpd_tls_cert_file = {{POSTFIX_TLS_CERT_FILE}}
smtpd_tls_key_file = {{POSTFIX_TLS_KEY_FILE}}
